<!doctype html>
<html lang="th">

<head>
  <!-- global stylesheet (single source of truth) -->
  <link rel="stylesheet" href="/global.css" />

  <!-- loader that injects layout/head.html into document.head and exposes window.__headLoaded Promise -->
  <script>
    (function () {
      async function loadHeadComponent(url, opts = {}) {
        try {
          const res = await fetch(url, { cache: 'no-cache' });
          if (!res.ok) throw new Error('Failed to load head component: ' + res.status);
          const text = await res.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, 'text/html');
          const headNodes = Array.from(doc.head.childNodes).filter(n => n.nodeType === 1);
          for (const node of headNodes) {
            if (node.tagName && node.tagName.toLowerCase() === 'script') {
              const s = document.createElement('script');
              for (const attr of node.attributes) s.setAttribute(attr.name, attr.value);
              if (!node.src) s.textContent = node.textContent;
              document.head.appendChild(s);
              if (s.src) {
                await new Promise((resolve) => {
                  s.addEventListener('load', resolve);
                  s.addEventListener('error', () => { console.warn('Script failed to load:', s.src); resolve(); });
                });
              }
            } else {
              document.head.appendChild(node.cloneNode(true));
            }
          }
          if (opts.title) document.title = opts.title;
        } catch (err) {
          console.error(err);
        }
      }

      window.__headLoaded = loadHeadComponent('/layout/layout.html');
    })();
  </script>
</head>

<body>
  <main class="site-main">
    <div class="card">
      <img src="/img/logo.png" alt="โลโก้" class="logo" />
      <h1>Prototype</h1>
      <p>เลือกระบบที่ต้องการใช้งานจากด้านล่าง</p>

      <a class="button primary" href="/upload.html">อัปโหลดรูปไป pic.in.th</a>
      <a class="button secondary" href="/mail.html">ฟอร์มส่งอีเมล</a>
      <a class="button secondary" href="/maileroo.html">ฟอร์มส่งอีเมลผ่าน Maileroo</a>
    </div>
  </main>

  <!-- สคริปต์: ดักการคลิกปุ่ม "ฟอร์มส่งอีเมล" ให้แสดง SweetAlert แทนการนำทาง -->
  <script>
    (async function () {
      // หา anchor ที่ชี้ไปยัง /mail.html (ปรับ selector ถ้าคุณเปลี่ยน href)
      const mailBtn = document.querySelector('a.button.secondary[href="/mail.html"], a[href$="/mail.html"]');
      if (!mailBtn) return;

      // รอให้ head component โหลด (ถ้ามี) เพื่อให้ SweetAlert พร้อมใช้งาน
      try { if (window.__headLoaded) await window.__headLoaded; } catch (e) { /* ignore */ }

      mailBtn.addEventListener('click', function (e) {
        e.preventDefault(); // หยุดการนำทาง

        const title = 'ส่งอีเมล';
        const message = 'การส่งเมลแบบ SMTP ยังไม่รองรับในระบบตอนนี้<br><small>ทดสอบใน local ได้ปกติ</small>';

        if (window.Swal && typeof Swal.fire === 'function') {
          Swal.fire({
            icon: 'info',
            title: title,
            html: message,
            confirmButtonText: 'ตกลง'
          });
        } else {
          // fallback ถ้า SweetAlert ยังไม่โหลด
          alert('ส่งอีเมล — การส่งเมลแบบ SMTP ยังไม่รองรับในระบบตอนนี้\n(ทดสอบบน local ได้ปกติ)');
        }
      });
    })();

    (async function () {
  try {
    const res = await fetch('/components/footer.html', { cache: 'no-cache' });
    if (!res.ok) return console.warn('Could not load footer:', res.status);

    const text = await res.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(text, 'text/html');

    // หา element footer จาก parsed doc
    const footer = doc.body.querySelector('footer.site-footer');
    if (!footer) {
      // fallback: ถ้าไม่มี footer ให้แทรก raw HTML
      document.body.insertAdjacentHTML('beforeend', text);
      return;
    }

    // แยก scripts ออกมาก่อน (เราจะ execute ด้วยการสร้างใหม่)
    const scripts = Array.from(footer.querySelectorAll('script'));
    scripts.forEach(s => s.parentNode && s.parentNode.removeChild(s));

    // นำ footer ที่เหลือมาแทรกใน document
    document.body.appendChild(footer);

    // สร้างและแนบ script ใหม่เป็น child ของ footer (จะ execute)
    for (const s of scripts) {
      const newS = document.createElement('script');
      // คัดลอก attributes (เช่น src, type, async)
      for (const a of s.attributes) newS.setAttribute(a.name, a.value);
      if (s.src) {
        // ถ้าเป็น external src: append จะโหลดและ execute อัตโนมัติ
        footer.appendChild(newS);
        // (ถ้าต้องการรอให้ script โหลดเสร็จ ก่อนทำอย่างอื่น ให้เพิ่ม await/Promise)
      } else {
        // Inline script: ใส่ textContent แล้ว append จะ execute
        newS.textContent = s.textContent;
        footer.appendChild(newS);
      }
    }
  } catch (err) {
    console.error('Footer load error', err);
  }
})();
  </script>
</body>

</html>